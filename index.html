<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>PNG Auto Crop</title>
  <link href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Pretendard', 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #f6f5f9, #ffffff);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
      color: #3a2f4d;
      max-width: 720px;
      margin: auto;
    }
    h1 { font-size: 28px; font-weight: 700; color: #4a3f63; margin-bottom: 8px; text-align: center; }
    p.subtitle { color: #555; margin-bottom: 28px; font-size: 15px; text-align: center; line-height: 1.6; }
    .upload-box {
      width: 100%; padding: 20px; border: 2px dashed #c2bfd0; border-radius: 12px;
      background: #fff; cursor: pointer; font-size: 14px; color: #3a2f4d; text-align: center;
      transition: all 0.2s ease;
    }
    .upload-box:hover { background: #faf9fc; border-color: #a084ca; }
    input[type=file] { display: none; }
    .btn {
      padding: 12px 30px; margin-top: 18px; background: #a084ca; color: #fff;
      border: none; border-radius: 25px; cursor: pointer; font-size: 15px; font-weight: 600;
      transition: all 0.2s ease;
    }
    .btn:hover { background: #8c6fc7; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    #preview {
      margin-top: 32px; width: 100%; text-align: center; border: 1px solid #e2e2e2;
      padding: 18px; background: #fff; border-radius: 14px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    #thumbs {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 20px;
      width: 100%;
    }
    #thumbs div { position: relative; display: inline-block; text-align:center; }
    #thumbs img {
      width: 120px; height: 120px; object-fit: contain;
      border: 1px solid #ccc; border-radius: 8px; background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    #thumbs button {
      position: absolute;
      top: 6px; right: 6px;
      background: none; border: none;
      color: #333; font-size: 20px; font-weight: 300;
      cursor: pointer; line-height: 1; padding: 0;
      transition: color 0.2s ease;
    }
    #thumbs button:hover { color: #000; }
    #loading { margin-top: 20px; font-size: 15px; color: #6c5b7b; display: none; font-weight: 600; }
    #loading .scissors { display: inline-block; animation: cut 1s infinite; }
    @keyframes cut {
      0% { transform: rotate(0deg); } 25% { transform: rotate(-20deg); }
      50% { transform: rotate(0deg); } 75% { transform: rotate(20deg); }
      100% { transform: rotate(0deg); }
    }
  </style>
</head>
<body>
  <h1>PNG Auto Crop</h1>
  <p class="subtitle">
    One-click PNG cropping. Say goodbye to empty transparent space.<br>
    í´ë¦­ í•œ ë²ˆìœ¼ë¡œ PNG ì—¬ë°± ì œê±°
  </p>

  <!-- ì—…ë¡œë“œ ì•ˆë‚´ -->
  <label for="file" class="upload-box">
    PNG íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”<br>
    <span style="font-size:13px; color:#888;">Select or Drag & Drop PNG (Up to 3)</span>
  </label>
  <input type="file" id="file" accept="image/png" multiple>

  <!-- ì¸ë„¤ì¼ ë¯¸ë¦¬ë³´ê¸° -->
  <div id="thumbs"></div>

  <!-- í¬ë¡­ ë²„íŠ¼ -->
  <button class="btn" onclick="upload()"> í¬ë¡­ | Crop</button>

  <!-- ë¡œë”© -->
  <div id="loading">
    <span class="scissors">âœ‚ï¸</span> ì‘ì—… ì¤‘... / Processing...
  </div>

  <!-- ê²°ê³¼ -->
  <div id="preview"></div>

  <script>
    let selectedFiles = [];

    // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
    document.getElementById('file').addEventListener('change', (e) => {
      const files = Array.from(e.target.files);
      if (files.length > 3) {
        alert("âš ï¸ ìµœëŒ€ 3ê°œì˜ PNG íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nMaximum 3 PNGs allowed.");
        e.target.value = "";
        selectedFiles = [];
        document.getElementById('thumbs').innerHTML = "";
        return;
      }
      selectedFiles = files;
      renderThumbnails(); // ì¸ë„¤ì¼ í‘œì‹œ
    });

    // ì¸ë„¤ì¼ ë¯¸ë¦¬ë³´ê¸°
    function renderThumbnails() {
      const thumbs = document.getElementById('thumbs');
      thumbs.innerHTML = "";
      selectedFiles.forEach((file, index) => {
        if (!file.type.startsWith("image/")) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
          const wrapper = document.createElement("div");
          const img = document.createElement("img");
          img.src = ev.target.result;

          const delBtn = document.createElement("button");
          delBtn.textContent = "âœ–"; // ì¼ë°˜ X
          delBtn.onclick = () => {
            selectedFiles.splice(index, 1);
            renderThumbnails();
          };

          wrapper.appendChild(img);
          wrapper.appendChild(delBtn);

          // ğŸ‘‰ ì¶”ê°€: ê°œë³„ PNG ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ì„ ë¶™ì¼ ìë¦¬ (ë‚˜ì¤‘ì— upload()ì—ì„œ ì±„ì›Œì§)
          const indivBtn = document.createElement("div");
          indivBtn.id = "indiv_" + index;
          indivBtn.style.marginTop = "6px";
          wrapper.appendChild(indivBtn);

          thumbs.appendChild(wrapper);
        };
        reader.readAsDataURL(file);
      });
    }

    // ì—…ë¡œë“œ ë° ê²°ê³¼ ë‹¤ìš´ë¡œë“œ
    async function upload() {
      if (!selectedFiles.length) {
        alert("âš ï¸ PNG íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.\nPlease select PNG files!");
        return;
      }

      const loading = document.getElementById('loading');
      const preview = document.getElementById('preview');
      loading.style.display = "block";
      preview.innerHTML = "";

      // ZIP ìš”ì²­ (ê¸°ì¡´ ë°©ì‹)
      const formData = new FormData();
      selectedFiles.forEach((file) => formData.append("files", file));

      try {
        const res = await fetch("https://loopyti-loopyti-crop-tool.hf.space/crop", {
          method: "POST",
          body: formData
        });

        if (!res.ok) {
          const text = await res.text();
          throw new Error(text);
        }

        const blob = await res.blob();
        const url = URL.createObjectURL(blob);

        // ZIP ë‹¤ìš´ë¡œë“œ ë²„íŠ¼
        preview.innerHTML = `
          <h3 style="color:#6c5b7b; font-weight:600;">ê²°ê³¼ ë‹¤ìš´ë¡œë“œ</h3>
          <a href="${url}" download="cropped_images.zip">
            <button class="btn" style="margin-top:14px;">â¬‡ï¸ ZIP ë‹¤ìš´ë¡œë“œ</button>
          </a>
        `;

        // ğŸ‘‰ ì¶”ê°€: ê°œë³„ PNG ìš”ì²­ (íŒŒì¼ë§ˆë‹¤ ë”°ë¡œ ì„œë²„ì— ë³´ë‚´ê³  ê²°ê³¼ ë²„íŠ¼ ë¶™ì„)
        selectedFiles.forEach(async (file, index) => {
          const fd = new FormData();
          fd.append("files", file); // ì„œë²„ëŠ” ì—¬ëŸ¬ ê°œë„ ë°›ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” 1ê°œë§Œ ì „ë‹¬

          try {
            const r = await fetch("https://loopyti-loopyti-crop-tool.hf.space/crop", {
              method: "POST",
              body: fd
            });
            if (!r.ok) throw new Error(await r.text());
            const b = await r.blob();
            const u = URL.createObjectURL(b);

            // ê°œë³„ PNG ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ìƒì„±
            const link = document.createElement("a");
            link.href = u;
            link.download = "cropped_" + file.name;
            link.textContent = "â¬‡ï¸ ê°œë³„ PNG ë‹¤ìš´ë¡œë“œ";
            link.className = "btn";
            link.style.display = "inline-block";
            link.style.marginTop = "8px";

            // ì¸ë„¤ì¼ ì•„ë˜ indivBtnì— ë¶™ì´ê¸°
            document.getElementById("indiv_" + index).appendChild(link);
          } catch (err) {
            console.error(err);
          }
        });

      } catch (err) {
        alert(err.message);
      }

      loading.style.display = "none";
    }
  </script>
</body>
</html>
